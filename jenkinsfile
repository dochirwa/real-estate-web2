node('appserver')
{
    def app

        stage('Cloning Git')
        {
            checkout scm
        }

        stage('Build-and-Tag')
        {
            app = docker.build('dchirwa/real-estate-web2')
        }

        stage('Post-to-DockerHub')
        {
            docker.withRegistry('https://registry.docker.io', 'dockerhub-credentials')
            {
                app.push('latest')
            }
        }

        stage('Deploy')
        {
            sh 'docker-compose down'
            sh 'docker-compose up -d'
        }
}